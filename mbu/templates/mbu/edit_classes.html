{% extends 'base.html' %}
{% load staticfiles %}
{% block scripts %}
    <script type="application/javascript">
        var ViewModel = function() {
            var self = this;

            self.courses = ko.observableArray();
            self.enrollments = ko.observableArray();
            self.filteredCourses = ko.computed(function() {
                return self.courses().filter(function(course) {
                    var result = true
                    self.enrollments().forEach(function(enrollment) {
                        if (enrollment.course.id === course.course.id) {
                            result = false;
                        }
                    });
                    return result;
                });
            }, self)
        {% for timeblock in timeblocks %}; self.timeblock_{{ timeblock.pk }} = ko.observable(){%  endfor %}
        };
        var vm = new ViewModel();
        $.getJSON('/api/courses', function(data) {
            data.courses.forEach(function(course) {
                var start = moment(course.timeblock.start_time).format('hh:mm A');
                var end = moment(course.timeblock.end_time).format('hh:mm A');
                course.time = start + ' - ' + end;
                vm.courses.push(course);
            })
        });
        $.getJSON('/api/enrollments', function(data) {
            data.enrollments.forEach(function(enrollment) {
                var start = moment(enrollment.timeblock.start_time).format('hh:mm A');
                var end = moment(enrollment.timeblock.end_time).format('hh:mm A');
                enrollment.time = start + ' - ' + end;
                vm['timeblock_' + enrollment.timeblock.id](enrollment);
                vm.enrollments.push(enrollment);
            })
        });
        ko.applyBindings(vm);
    </script>
{% endblock %}
{% block content %}
    <div data-bind="text: name"></div>
    <div class="row schedule">
        <div class="col-md-7">
            <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Class Name</th>
                  </tr>
                </thead>
                <tbody>
                    {% for timeblock in timeblocks %}
                    <tr style="height: 80px">
                        <td class="col-md-2">{{ timeblock.start_time|date:"h:i A" }} - {{ timeblock.end_time|date:"h:i A" }}</td>
                        <td class="col-md-5" data-bind="with: timeblock_{{ timeblock.pk }}">
                            <div class="row">
                                <div class="course-icon">
                                    <img data-bind="attr: {'src': '/static/images/badges/' + course.image_name}" class="mb-course"/>
                                </div>
                                <div class="course-desc">
                                    <div data-bind="text: course.name"></div>
                                    <div data-bind="text: time"></div>
                                    <div data-bind="text: location"></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="col-md-5 class-list">
            <div data-bind="foreach:filteredCourses">
                <div class="row">
                    <div class="course-icon">
                        <img data-bind="attr: {'src': '/static/images/badges/' + course.image_name}" class="mb-course"/>
                    </div>
                    <div class="course-desc">
                        <div data-bind="text: course.name"></div>
                        <div data-bind="text: time"></div>
                        <div data-bind="text: location"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <button class="btn btn-primary">Submit</button>
        </div>
    </div>
        
{% endblock %}
